# Voice to MD

macOSのメニューバーに常駐し、音声を録音して文字起こしと話者分離を行い、Markdownファイルとしてデスクトップに保存するアプリケーションです。

## 機能

- メニューバーからワンクリックで録音開始/停止
- 高精度な文字起こし（faster-whisper small モデル）
- 話者の自動識別とラベル付け（Speaker 1, Speaker 2, ...）
- 処理中は進捗ウィンドウを表示
- タイムスタンプ付きの見やすいMarkdown出力

## 出力例

```markdown
# MTGメモ - 2025/01/21 17:00

録音時間: 5分30秒
検出された話者数: 2

---

**Speaker 1** [00:00 - 00:15]
それでは定例を始めます。今日は新機能のリリーススケジュールについて確認したいと思います。

**Speaker 2** [00:15 - 00:42]
はい。現状の進捗ですが、開発は完了していてQAに入っています。
```

## 必要環境

- macOS
- Python 3.11
- マイク（内蔵または外部）

## セットアップ

```bash
cd ~/Desktop/voice-to-md
chmod +x setup.sh run.sh
./setup.sh
```

## 使い方

1. アプリを起動
   ```bash
   ./run.sh
   ```

2. メニューバーに「🎤 Voice」が表示される

3. クリック → 「録音 開始/停止」で録音開始
   - メニューバーが「🔴 REC」に変化

4. 再度「録音 開始/停止」で録音停止
   - 進捗ウィンドウが表示され、処理状況が確認できる
   - 「話者を分析中...」→「文字起こし中...」→「ファイルを保存中...」

5. 処理完了後、デスクトップに `voice_YYYYMMDD_HHMMSS.md` が作成される

6. 終了: クリック → 「終了」

## 処理時間の目安

| 録音時間 | 処理時間 |
|---------|---------|
| 1分 | 約20〜30秒 |
| 5分 | 約1〜2分 |
| 15分 | 約2〜3分 |
| 30分 | 約4〜5分 |

※ CPUで処理するため、マシンスペックにより異なります

## 初回起動時の注意

- Whisperモデル（約500MB）が自動ダウンロードされる
- SpeechBrainの話者埋め込みモデル（約100MB）が自動ダウンロードされる
- マイクへのアクセス許可が必要

## 制約事項

- 話者の名前は自動特定されない（後から手動で置換してください）
- 同時に話している箇所は精度が落ちる可能性がある
- 声質が似ている話者は誤認識する場合がある
- 話者分離は10秒単位で行うため、短い発言が多い会話では精度が落ちる可能性がある

## トラブルシューティング

### 初回起動が遅い
モデルダウンロード中です。数分お待ちください。

### マイクエラー
システム設定 > プライバシーとセキュリティ > マイク でターミナルを許可

### 話者が正しく分かれない
- 音声品質が低い場合は精度が落ちます
- 話者が3人以上の場合は誤認識が増える可能性があります
- 一人で話している場合も、無音区間でSpeaker 1, Speaker 2と分かれることがあります

### メモリ不足エラー
30分以上の長時間録音は、処理時にメモリを多く消費します。不要なアプリを閉じてお試しください。

## 技術スタック

- **rumps**: macOSメニューバーUI
- **sounddevice**: 音声録音
- **scipy**: WAVファイル保存
- **faster-whisper**: 音声認識（Whisperの高速実装）
- **SpeechBrain**: 話者埋め込み（ECAPA-TDNN）
- **scikit-learn**: クラスタリング（MeanShift）
